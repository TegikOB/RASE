<?xml version="1.0"?>
  <database name="VIEW BI_VENTA_OBJETIVO_V">
    <view name="BI_VENTA_OBJETIVO_V"><![CDATA[SELECT get_uuid() AS bi_venta_objetivo_v_id, COALESCE(a.ad_client_id, b.ad_client_id) AS ad_client_id, COALESCE(a.ad_org_id, b.ad_org_id) AS ad_org_id, 'Y' AS isactive, now() AS created, COALESCE(a.ad_client_id, b.ad_client_id) AS createdby, now() AS updated, COALESCE(a.ad_client_id, b.ad_client_id) AS updatedby, COALESCE(a.organizacion, b.organizacion) AS organizacion, COALESCE(a.agente, b.agente) AS agente, COALESCE(a.categoria, b.categoria) AS categoria, COALESCE(a.producto, b.producto) AS producto, COALESCE(a.mes, b.mes) AS mes, COALESCE(a.mes_nom, b.mes_nom) AS mes_nom, COALESCE(a.actualuds, 0) AS actualuds, COALESCE(a.actualmxn, 0) AS actualmxn, COALESCE(b.anterioruds, 0) AS anterioruds, COALESCE(b.anteriormxn, 0) AS anteriormxn FROM (SELECT c_invoice.ad_client_id, c_invoice.ad_org_id, max(ad_org.name) AS organizacion, COALESCE(c_invoice.salesrep_id, 'ND') AS salesrep_id, max(COALESCE(ad_user.name, 'ND')) AS agente, m_product.m_product_category_id, max(COALESCE(m_product_category.name, 'ND')) AS categoria, c_invoiceline.m_product_id, max(m_product.name) AS producto, date_part('MONTH', c_invoice.dateinvoiced) AS mes, max(bi_mes_nombre(c_invoice.dateinvoiced)) AS mes_nom, sum(c_invoiceline.qtyinvoiced) AS actualuds, sum(c_currency_convert_precision(c_invoiceline.linenetamt, c_currency.c_currency_id, ad_org.c_currency_id, c_invoice.dateinvoiced, 'S', c_invoice.ad_client_id, c_invoice.ad_org_id, 'A')) AS actualmxn FROM c_invoice LEFT JOIN c_invoiceline ON c_invoice.c_invoice_id = c_invoiceline.c_invoice_id JOIN c_doctype ON c_invoice.c_doctype_id = c_doctype.c_doctype_id AND c_doctype.docbasetype = 'ARI' LEFT JOIN c_bpartner ON c_invoice.c_bpartner_id = c_bpartner.c_bpartner_id LEFT JOIN m_product ON c_invoiceline.m_product_id = m_product.m_product_id LEFT JOIN m_product_category ON m_product.m_product_category_id = m_product_category.m_product_category_id LEFT JOIN ad_user ON c_invoice.salesrep_id = ad_user.ad_user_id LEFT JOIN ad_org ON c_invoice.ad_org_id = ad_org.ad_org_id LEFT JOIN c_currency ON c_invoice.c_currency_id = c_currency.c_currency_id JOIN ad_client ON c_invoice.ad_client_id = ad_client.ad_client_id AND ad_client.em_bi_es_productivo = 'Y' WHERE c_invoice.docstatus = 'CO' AND c_invoice.issotrx = 'Y' AND c_invoiceline.qtyinvoiced > 0 AND date_part('YEAR', c_invoice.dateinvoiced) = date_part('YEAR', now()) GROUP BY c_invoice.ad_client_id, c_invoice.ad_org_id, c_invoice.salesrep_id, m_product.m_product_category_id, c_invoiceline.m_product_id, date_part('MONTH', c_invoice.dateinvoiced)) a FULL JOIN (SELECT c_invoice.ad_client_id, c_invoice.ad_org_id, max(ad_org.name) AS organizacion, COALESCE(c_invoice.salesrep_id, 'ND') AS salesrep_id, max(COALESCE(ad_user.name, 'ND')) AS agente, m_product.m_product_category_id, max(COALESCE(m_product_category.name, 'ND')) AS categoria, c_invoiceline.m_product_id, max(m_product.name) AS producto, date_part('MONTH', c_invoice.dateinvoiced) AS mes, max(bi_mes_nombre(c_invoice.dateinvoiced)) AS mes_nom, sum(c_invoiceline.qtyinvoiced) AS anterioruds, sum(c_currency_convert_precision(c_invoiceline.linenetamt, c_currency.c_currency_id, ad_org.c_currency_id, c_invoice.dateinvoiced, 'S', c_invoice.ad_client_id, c_invoice.ad_org_id, 'A')) AS anteriormxn FROM c_invoice LEFT JOIN c_invoiceline ON c_invoice.c_invoice_id = c_invoiceline.c_invoice_id JOIN c_doctype ON c_invoice.c_doctype_id = c_doctype.c_doctype_id AND c_doctype.docbasetype = 'ARI' LEFT JOIN c_bpartner ON c_invoice.c_bpartner_id = c_bpartner.c_bpartner_id LEFT JOIN m_product ON c_invoiceline.m_product_id = m_product.m_product_id LEFT JOIN m_product_category ON m_product.m_product_category_id = m_product_category.m_product_category_id LEFT JOIN ad_user ON c_invoice.salesrep_id = ad_user.ad_user_id LEFT JOIN ad_org ON c_invoice.ad_org_id = ad_org.ad_org_id LEFT JOIN c_currency ON c_invoice.c_currency_id = c_currency.c_currency_id JOIN ad_client ON c_invoice.ad_client_id = ad_client.ad_client_id AND ad_client.em_bi_es_productivo = 'Y' WHERE c_invoice.docstatus = 'CO' AND c_invoice.issotrx = 'Y' AND c_invoiceline.qtyinvoiced > 0 AND bi_anio(c_invoice.dateinvoiced) = bi_anio_anterior('2014-06-23 17:50:59.474556') AND date_part('MONTH', c_invoice.dateinvoiced) <= date_part('MONTH', now()) GROUP BY c_invoice.ad_client_id, c_invoice.ad_org_id, c_invoice.salesrep_id, m_product.m_product_category_id, c_invoiceline.m_product_id, date_part('MONTH', c_invoice.dateinvoiced)) b ON a.ad_client_id = b.ad_client_id AND a.ad_org_id = b.ad_org_id AND a.salesrep_id = b.salesrep_id AND a.m_product_category_id = b.m_product_category_id AND a.m_product_id = b.m_product_id AND a.mes = b.mes]]></view>
  </database>
