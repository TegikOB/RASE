<?xml version="1.0"?>
  <database name="FUNCTION TEGIDL_ACTUALIZASALESREP">
    <function name="TEGIDL_ACTUALIZASALESREP" type="NULL">
      <parameter name="p_client_id" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <body><![CDATA[v_id VARCHAR(32);
CUR_FACTURAS_ERRONEAS RECORD;
  
BEGIN

FOR CUR_FACTURAS_ERRONEAS IN
(SELECT C_INVOICE_ID, W.EM_ALMAC_DUENO_ID, DOCUMENTNO, I.DOCSTATUS
FROM C_INVOICE I
INNER JOIN M_LOCATOR L ON I.EM_VTAPISO_LOCATOR_ID = L.M_LOCATOR_ID AND I.AD_CLIENT_ID = '2A43480AA2424DC78A3549C2EA0B8AA3' 
INNER JOIN M_WAREHOUSE W ON W.M_WAREHOUSE_ID = L.M_WAREHOUSE_ID  AND COALESCE(I.SALESREP_ID,'ASDASD') <> W.EM_ALMAC_DUENO_ID AND I.DOCSTATUS = 'CO' AND I.ISSOTRX = 'Y' AND COALESCE(EM_ALMAC_ESSAD,'N') = 'Y'
INNER JOIN C_DOCTYPE DT ON I.C_DOCTYPE_ID = DT.C_DOCTYPE_ID AND DT.EM_VTAPISO_ISVTAPISO = 'Y')
LOOP
DBMS_OUTPUT.PUT_LINE( 'ACTUALIZANDO> ' || CUR_FACTURAS_ERRONEAS.DOCUMENTNO || ' -- ' || CUR_FACTURAS_ERRONEAS.DOCSTATUS);
UPDATE C_INVOICE SET DOCSTATUS = DOCSTATUS, SALESREP_ID = CUR_FACTURAS_ERRONEAS.EM_ALMAC_DUENO_ID WHERE C_INVOICE_ID = CUR_FACTURAS_ERRONEAS.C_INVOICE_ID;
END LOOP;

RETURN;


EXCEPTION WHEN OTHERS THEN
  DBMS_OUTPUT.PUT_LINE(SQLERRM) ;
  RAISE;
END TEGIDL_ACTUALIZASALESREP
]]></body>
    </function>
  </database>
