<?xml version="1.0"?>
  <database name="FUNCTION TEGIDL_UPDATEAGENTE_MAYOREO">
    <function name="TEGIDL_UPDATEAGENTE_MAYOREO" type="NULL">
      <parameter name="p_client_id" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <body><![CDATA[v_id VARCHAR(32);
CUR_FACTURAS_ERRONEAS RECORD;
  
BEGIN

FOR CUR_FACTURAS_ERRONEAS IN
(SELECT C_INVOICE_ID, I.DOCUMENTNO, I.DOCSTATUS, R.SALESREP_ID
FROM C_INVOICE I
INNER JOIN C_BPARTNER BP ON I.C_BPARTNER_ID = BP.C_BPARTNER_ID AND I.AD_CLIENT_ID = p_client_id AND I.SALESREP_ID IS NULL
INNER JOIN RUTAS_RUTAS R ON BP.EM_RUTAS_RUTAS_ID = R.RUTAS_RUTAS_ID
)
LOOP
DBMS_OUTPUT.PUT_LINE( 'ACTUALIZANDO> ' || CUR_FACTURAS_ERRONEAS.DOCUMENTNO || ' -- ' || CUR_FACTURAS_ERRONEAS.DOCSTATUS);
UPDATE C_INVOICE SET DOCSTATUS = DOCSTATUS, SALESREP_ID = CUR_FACTURAS_ERRONEAS.SALESREP_ID WHERE C_INVOICE_ID = CUR_FACTURAS_ERRONEAS.C_INVOICE_ID;
END LOOP;

RETURN;


EXCEPTION WHEN OTHERS THEN
  DBMS_OUTPUT.PUT_LINE(SQLERRM) ;
  RAISE;
END TEGIDL_UPDATEAGENTE_MAYOREO
]]></body>
    </function>
  </database>
